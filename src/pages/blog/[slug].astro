---
import Layout from "../../layouts/Layout.astro";

interface Post {
  id: string;
  title: string;
  content: string;
  excerpt: string;
  slug: string;
  featuredImage?: string;
  status: string;
  publishedAt?: string;
  readingTime: number;
  language: string;
  sports?: Array<{ id: string; name: string }>;
}

export async function getStaticPaths() {
  // Cridar l'API per obtenir tots els articles
  const res = await fetch(import.meta.env.API_BASE_URL + "articles");
  const posts = await res.json();

  // Generar una ruta per a cada article
  return posts.map((post: Post) => ({
    params: { slug: post.slug },
    props: { post, allPosts: posts },
  }));
}

// Les props es reben automàticament
const { post, allPosts } = Astro.props as { post: Post; allPosts: Post[] };

console.error(" Building route for slug:", post.slug);
console.error("✅ Post data received:", post.title);
---

<Layout
  title={post.title}
  description={post.excerpt}
  currentLang={post.language}
>
  <article class="prose max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-6">{post.title}</h1>

    {
      post.featuredImage && (
        <img
          src={post.featuredImage}
          alt={post.title}
          class="w-full h-64 object-cover rounded-lg mb-6"
        />
      )
    }

    <div class="mb-6 text-gray-600">
      <p class="mb-2"><strong>Extracte:</strong> {post.excerpt}</p>
      {
        post.readingTime > 0 && (
          <p class="mb-2">
            <strong>Temps de lectura:</strong> {post.readingTime} minuts
          </p>
        )
      }
      {
        post.publishedAt && (
          <p class="mb-2">
            <strong>Data de publicació:</strong>{" "}
            {new Date(post.publishedAt).toLocaleDateString("es-ES")}
          </p>
        )
      }
      {
        post.sports && post.sports.length > 0 && (
          <div class="mb-4">
            <strong>Deportes:</strong>
            <div class="flex gap-2 mt-2">
              {post.sports.map((sport) => (
                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                  {sport.name}
                </span>
              ))}
            </div>
          </div>
        )
      }
    </div>

    <div class="prose prose-lg max-w-none">
      {
        post.content
          .split("\n\n")
          .map((paragraph, index) => (
            <p class="mb-4 leading-relaxed">{paragraph}</p>
          ))
      }
    </div>
  </article>
</Layout>
