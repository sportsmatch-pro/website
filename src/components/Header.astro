---
import LanguageSelector from "./LanguageSelector.astro";
import HeaderLogoIcon from "./HeaderLogoIcon.astro";

// Props per a l'idioma actual i slug de l'article
export interface Props {
  title?: string;
  currentLang?: string;
  currentSlug?: string;
  translationRoutes?: { [key: string]: string }; // NOU: rutes de traducció
}

const {
  title,
  currentLang = "es-ES",
  currentSlug,
  translationRoutes,
} = Astro.props;

// Obtenir la ruta actual per determinar si estem en un article
const currentPath = Astro.url.pathname;
const isArticlePage = currentPath.includes("/blog/");

// Si estem en un article i no tenim slug, intentar extreure'l de la URL
let articleSlug = currentSlug;
if (isArticlePage && !articleSlug) {
  const pathSegments = currentPath.split("/");
  const blogIndex = pathSegments.indexOf("blog");
  if (blogIndex !== -1 && pathSegments[blogIndex + 1]) {
    articleSlug = pathSegments[blogIndex + 1];
  }
}

// Traduccions hardcoded amb rutes (mateixa estratègia que el footer)
const translations = {
  "es-ES": {
    home: { text: "SPORTSMATCH", href: "/" },
    blog: { text: "Blog", href: "/blog" },
    contact: { text: "Pregúntanos", href: "/#contact" },
    dream: { text: "Tu sueño, a tu alcance", href: "/#dream" },
    star: { text: "Encuentra a tu próxima estrella", href: "/#star" },
  },
  "ca-ES": {
    home: { text: "SPORTSMATCH", href: "/ca" },
    blog: { text: "Blog", href: "/ca/blog" },
    contact: { text: "Pregunta'ns", href: "/ca/#contact" },
    dream: { text: "El teu somni, a l'abast", href: "/ca/#dream" },
    star: { text: "Troba la teva pròxima estrella", href: "/ca/#star" },
  },
  en: {
    home: { text: "SPORTSMATCH", href: "/en" },
    blog: { text: "Blog", href: "/en/blog" },
    contact: { text: "Ask us", href: "/en/#contact" },
    dream: { text: "Your dream, at your reach", href: "/en/#dream" },
    star: { text: "Find your next star", href: "/en/#star" },
  },
};

const t =
  translations[currentLang as keyof typeof translations] ||
  translations["es-ES"];
---

<header
  class="fixed top-0 left-0 right-0 bg-white shadow-md z-50 header-scrollable"
  id="main-header"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-[1fr_auto_1fr] items-center h-20">
      <!-- Columna esquerra: Navegació -->
      <div class="flex justify-start">
        <nav class="hidden lg:flex space-x-4">
          <a
            href={t.dream.href}
            class="text-gray-700 hover:text-gray-900 py-2 text-sm"
          >
            {t.dream.text}
          </a>
          <a
            href={t.star.href}
            class="text-gray-700 hover:text-gray-900 py-2 text-sm"
          >
            {t.star.text}
          </a>
        </nav>
      </div>

      <!-- Columna central: Logo (sempre centrat) -->
      <div class="flex justify-center">
        <a href={t.home.href} class="flex items-center">
          <HeaderLogoIcon
            width={140}
            height={70}
            color="#000"
            secondaryColor="#999"
            accentColor="#000"
          />
        </a>
      </div>

      <!-- Columna dreta: Selector d'idioma i navegació -->
      <div class="flex justify-end items-center space-x-4">
        <div class="hidden lg:flex">
          <LanguageSelector
            currentLang={currentLang}
            currentSlug={articleSlug}
            translationRoutes={translationRoutes}
          />
        </div>
        <!-- Navegació desktop -->
        <nav class="hidden lg:flex space-x-4 items-center">
          <a
            href={t.blog.href}
            class="text-gray-700 hover:text-gray-900 py-2 text-sm"
          >
            {t.blog.text}
          </a>
          <a
            href={t.contact.href}
            class="bg-black text-white px-4 py-1 rounded-full hover:bg-gray-800 transition-colors text-sm"
          >
            {t.contact.text}
          </a>
        </nav>

        <!-- Botó mobile menu -->
        <button
          class="lg:hidden rounded-md p-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100"
          id="mobile-menu-button"
        >
          <svg
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Navegació mobile -->
  <div class="lg:hidden hidden" id="mobile-menu">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <a
        href={t.blog.href}
        class="text-gray-700 hover:text-gray-900 block px-3 py-2 text-base font-medium"
      >
        {t.blog.text}
      </a>
      <a
        href={t.contact.href}
        class="text-gray-700 hover:text-gray-900 block px-3 py-2 text-base font-medium"
      >
        {t.contact.text}
      </a>
      <LanguageSelector
        currentLang={currentLang}
        currentSlug={articleSlug}
        translationRoutes={translationRoutes}
      />
    </div>
  </div>
</header>

<script>
  // Funcionalitat del menú mobile
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
  }

  // Funcionalitat hide/show header amb scroll
  const header = document.getElementById("main-header");
  let lastScroll = 0;

  window.addEventListener("scroll", () => {
    const currentScroll = window.pageYOffset;

    if (header) {
      if (currentScroll <= 0) {
        // Som al top, mostra l'header
        header.classList.remove("header-hidden");
        header.classList.add("header-visible");
      } else if (currentScroll > lastScroll && currentScroll > 100) {
        // Scroll cap avall i ja hem fet més de 100px, amaga l'header
        header.classList.remove("header-visible");
        header.classList.add("header-hidden");
      } else if (currentScroll < lastScroll) {
        // Scroll cap amunt, mostra l'header
        header.classList.remove("header-hidden");
        header.classList.add("header-visible");
      }
    }

    lastScroll = currentScroll;
  });
</script>
